// Generated by CoffeeScript 1.8.0
(function() {
  var ECpageClass;

  ECpageClass = (function() {
    var root;

    root = {};

    ECpageClass.prototype._page_name = "";

    ECpageClass.prototype._item_info = {};

    ECpageClass.prototype._platform = "";

    ECpageClass.prototype._listview_data = {
      pullable: false,
      hasFooterDivider: false,
      hasHeaderDivider: true,
      dividerHeight: 1,
      dividerColor: "#EBEBEB",
      data: [
        {
          viewType: "ListViewCellInputText",
          inputType: "number",
          inputText: "560359093",
          hint: "课程码",
          name: "number"
        }, {
          viewType: "ListViewCellButton",
          btnTitle: "添  加",
          btnType: "ok",
          _type: "search"
        }
      ]
    };

    ECpageClass.prototype._constructor = function(_page_name) {
      this._page_name = _page_name;
      root = this;
      this.prepareForInitView();
      $A().page().widget("" + this._page_name + "_ListViewBase_0").data(JSON.stringify(this._listview_data));
      $A().page().widget("" + this._page_name + "_ListViewBase_0").onItemInnerClick(function(data) {
        return root.onItemInnerClick(data);
      });
      $A().page().widget("" + this._page_name + "_ListViewBase_0").onItemClick(function(data) {
        return root.onItemClick(data);
      });
      return $A().page().onCreated(function() {
        return root.onCreated();
      });
    };

    function ECpageClass(_page_name) {
      this._constructor(_page_name);
    }

    ECpageClass.prototype.onCreated = function() {
      if ((root._platform != null) && root._platform === "ios") {
        return $A().page().widget("" + this._page_name + "_ListViewBase_0").refreshData(JSON.stringify(this._listview_data));
      }
    };

    ECpageClass.prototype.onItemInnerClick = function(data) {
      if (root._listview_data.data[data.position]._type === "search") {
        if ((data._form.number != null) && data._form.number !== "") {
          if (data._form.number.length === 9) {
            $A().app().showLoadingDialog({
              content: "正在验证课程码"
            });
            return $A().app().callApi({
              method: "doctor_groups/detail",
              doctor_group_id: data._form.number,
              cacheTime: 0
            }).then(function(data) {
              $A().app().closeLoadingDialog();
              if ((data.courses != null) && data.courses.length > 0) {
                return $A().app().openPage({
                  page_name: "page_course_choose",
                  params: {
                    courses: JSON.stringify(data.courses)
                  },
                  close_option: "close"
                });
              } else {
                return $A().app().makeToast("请输入正确的机构码");
              }
            });
          } else {
            return $A().app().makeToast("请输入正确的机构码");
          }
        } else {
          return $A().app().makeToast("请输入机构码/课程码");
        }
      }
    };

    ECpageClass.prototype.onResume = function() {};

    ECpageClass.prototype.onResult = function() {};

    ECpageClass.prototype.prepareForInitView = function() {
      return $A().app().platform().then(function(platform) {
        return root._platform = platform;
      });
    };

    return ECpageClass;

  })();

  new ECpageClass("page_course_search");

}).call(this);
