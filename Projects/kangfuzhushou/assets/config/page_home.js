// Generated by CoffeeScript 1.9.1
(function() {
  var ECpageClass;

  ECpageClass = (function() {
    var getDayDiff, root;

    root = {};

    ECpageClass.prototype._page_name = "";

    ECpageClass.prototype._item_info = {};

    ECpageClass.prototype._pagerwidget_data = {
      pagerCount: 200,
      offset: 0,
      itemPageName: "page_home_pager"
    };

    ECpageClass.prototype._constructor = function(_page_name1) {
      this._page_name = _page_name1;
      root = this;
      this.prepareForInitView();
      $A().app().log("-----------------------------------");
      $A().page().widget("ActionBar").onItemClick(function(data) {
        return root.onItemClick(data);
      });
      $A().page().onResume(function() {
        return root.onResume();
      });
      $A().page().onResult(function(data) {
        return root.onResult(data);
      });
      $A().page().onPageSelected(function(data) {
        return root.onPageSelected(data);
      });
      return $A().page().onCreated(function() {
        return root.onCreated();
      });
    };

    function ECpageClass(_page_name) {
      this._constructor(_page_name);
    }

    ECpageClass.prototype.onCreated = function() {};

    ECpageClass.prototype.onItemClick = function(itemId) {
      var barTitle;
      switch ("" + itemId) {
        case "扫一扫":
          $A().page().openQRCapture({});
          break;
        case "管理课程":
          $A().app().openPage({
            page_name: "page_course_list",
            params: {},
            close_option: ""
          });
          break;
        case "设置时间":
          $A().app().openPage({
            page_name: "page_course_time_choose",
            params: {},
            close_option: ""
          });
          break;
        case "意见反馈":
          $A().app().openPage({
            page_name: "page_feedback",
            params: {},
            close_option: ""
          });
          break;
        case "Lee":
          $A().app().openPage({
            page_name: "page_lee",
            params: {},
            close_option: ""
          });
          break;
        case "登录":
          $A().app().openPage({
            page_name: "page_login",
            params: {},
            close_option: ""
          });
          break;
        case "设置":
          $A().app().openPage({
            page_name: "page_setting",
            params: {},
            close_option: ""
          });
          break;
        case "我的":
          $A().app().openPage({
            page_name: "page_my",
            params: {},
            close_option: ""
          });
          break;
        case "个人中心":
          $A().app().openPage({
            page_name: "page_mycenter",
            params: {},
            close_option: ""
          });
          break;
        case "搜索课程":
          $A().app().openPage({
            page_name: "page_course_search",
            params: {},
            close_option: ""
          });
      }
      if ((itemId.title != null) && itemId.title !== "undefined") {
        barTitle = itemId.title;
        return $A().app().showCalendarConfirm({
          title: "Test",
          date: barTitle
        }).then(function(data) {
          root._pagerwidget_data.offset = parseInt(parseInt(root._pagerwidget_data.offset) + parseInt(getDayDiff(data.dateStr, barTitle)));
          return $A().page("" + root._page_home).widget("page_home_PagerWidget_0").refreshData(JSON.stringify(root._pagerwidget_data));
        });
      }
    };

    ECpageClass.prototype.onItemInnerClick = function(data) {};

    ECpageClass.prototype.onPageSelected = function(data) {
      $A().page().param({
        key: "_now_offset",
        value: data.position
      });
      root._pagerwidget_data.offset = data.position;
      return $A().page().setTimeout("300").then(function() {
        $A().page("page_home_pager?offset=" + (parseInt(data.position))).callFun({
          "pageName": "onPageSelected",
          "input": {}
        });
        if (data.position === 0) {
          return $A().page().param({
            key: "is_first_open",
            value: "false"
          });
        }
      });
    };

    ECpageClass.prototype.onResume = function() {};

    ECpageClass.prototype.onResult = function(data) {
      var doctor_group_id;
      doctor_group_id = data.codeString.split("=")[1];
      this.showDoctorCourses(doctor_group_id);
      return "_false";
    };

    ECpageClass.prototype.prepareForInitView = function() {
      return $A().page().param({
        key: "is_first_open",
        value: "true"
      });
    };

    getDayDiff = function(day1_str, day2_str) {
      var day1, day1_arr, day2, day2_arr;
      day1_arr = day1_str.split('-');
      day1 = new Date(parseInt(day1_arr[0]), parseInt(Number(day1_arr[1]) - 1), Number(day1_arr[2]));
      day2_arr = day2_str.split('-');
      day2 = new Date(parseInt(day2_arr[0]), parseInt(Number(day2_arr[1]) - 1), Number(day2_arr[2]));
      return "" + (parseInt(day1.getTime() - day2.getTime()) / 86400000.);
    };

    ECpageClass.prototype.showDoctorCourses = function(doctor_group_id) {
      return $A().app().callApi({
        method: "doctor_groups/detail",
        doctor_group_id: doctor_group_id,
        cacheTime: 0
      }).then(function(data) {
        return $A().app().openPage({
          page_name: "page_course_choose",
          params: {
            courses: JSON.stringify(data.courses)
          },
          close_option: ""
        });
      });
    };

    return ECpageClass;

  })();

  new ECpageClass("page_home");

}).call(this);
