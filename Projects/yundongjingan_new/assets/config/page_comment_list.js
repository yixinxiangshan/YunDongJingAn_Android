// Generated by CoffeeScript 1.9.1
(function() {
  var ECpageClass, Page;

  ECpageClass = (function() {
    var root;

    root = {};

    ECpageClass.prototype._page_name = "";

    ECpageClass.prototype._item_info = {};

    ECpageClass.prototype._platform = "";

    ECpageClass.prototype._listview_data = {
      pullable: false,
      hasFooterDivider: true,
      hasHeaderDivider: true,
      dividerHeight: 1,
      dividerColor: "#EBEBEB",
      data: [
        {
          viewType: "ListViewCellLine",
          _rightLayoutSize: 0,
          _leftLayoutSize: 60,
          centerTitle: "正在加载......"
        }
      ]
    };

    ECpageClass.prototype._content_id = "";

    ECpageClass.prototype._constructor = function(_page_name1) {
      this._page_name = _page_name1;
      root = this;
      this.prepareForInitView();
      $A().page().widget(this._page_name + "_ListViewBase_0").data(JSON.stringify(this._listview_data));
      $A().page().widget(this._page_name + "_ListViewBase_0").onItemInnerClick(function(data) {
        return root.onItemInnerClick(data);
      });
      $A().page().widget(this._page_name + "_ListViewBase_0").onItemClick(function(data) {
        return root.onItemClick(data);
      });
      $A().page().onResume(function(data) {
        return root.onResume();
      });
      $A().page().onResult(function(data) {
        return root.onResult(data);
      });
      return $A().page().onCreated(function() {
        return root.onCreated();
      });
    };

    function ECpageClass(_page_name) {
      this._constructor(_page_name);
    }

    ECpageClass.prototype.onCreated = function() {
      return $A().app().callApi({
        method: "comment/comments",
        content_id: root._content_id,
        cacheTime: 0
      }).then(function(data) {
        var content, i, len, ref, results;
        if (data.errors != null) {
          if (data.errors[0].error_num != null) {
            return $A().app().makeToast("网络状态不好，请重新加载");
          } else {
            return $A().app().makeToast("没有网络");
          }
        } else {
          root._listview_data.data = [];
          if (data.count === 0) {
            root._listview_data.data = [];
            root._listview_data.data.push({
              viewType: "ListViewCellLine",
              centerTitle: "暂无信息"
            });
            $A().page().widget(root._page_name + "_ListViewBase_0").refreshData(JSON.stringify(root._listview_data));
          } else {

          }
          ref = data.content_list;
          results = [];
          for (i = 0, len = ref.length; i < len; i++) {
            content = ref[i];
            root._listview_data.data.push({
              viewType: "ListViewCellTwoLineText",
              headTitle: "" + content.title,
              headTime: "" + content.created_at,
              subTitle: "" + content.content,
              _leftLayoutSize: 75,
              id: "" + content.id,
              hasFooterDivider: "true"
            });
            results.push($A().page().widget(root._page_name + "_ListViewBase_0").refreshData(JSON.stringify(root._listview_data)));
          }
          return results;
        }
      });
    };

    ECpageClass.prototype.onItemClick = function(data) {};

    ECpageClass.prototype.onItemInnerClick = function(data) {};

    ECpageClass.prototype.onResume = function() {};

    ECpageClass.prototype.onResult = function(data) {};

    ECpageClass.prototype.prepareForInitView = function() {
      $A().app().platform().then(function(platform) {
        return root._platform = platform;
      });
      return $A().page().param("content_id").then(function(content_id) {
        return root._content_id = content_id;
      });
    };

    return ECpageClass;

  })();

  Page = new ECpageClass("page_comment_list");

}).call(this);
